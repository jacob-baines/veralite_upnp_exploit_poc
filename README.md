# runlua.html
## Overview
runlua.html when loaded in a browser, will attempt to get a reverse shell
on a VeraLite device on the client's network. This is achieved with the
following steps:

1. Acquire the client's internal IP address using webrtc. We then assume the
   client is operating on a \24 network.
2. POST :49451/z3n.html to every address on the subnet. This leverages two
   things we know to be true about VeraLite:
       - there should be a UPnP HTTP server on 49451
       - VeraLite uses a libupnp vulnerable to CVE-2016-6255.
3. Attempt to load :49451/z3n.html in an iframe. This will exist if step 2
   successfully created the file via CVE-2016-6255
4. z3n.html will allow us to bypass same origin policy and it will make a
   POST request that executes RunLau. This also leverages information we
   know to be true about Veralite:
       - the control URL for HomeAutomationGateway is /upnp/control/hag
       - no auth required
5. Our RunLua code executes a reverse shell to 192.168.217:1270.

## Reverse Shell
The listener address and port are hard coded into runlua.html

## Performance Issues
This code doesn't run fast in Firefox. This appears to largely be a performance
issue associated with attaching a lot of iframes to a page. Give the shell
popping a couple of minutes. In Chrome, it runs pretty fast but might
exhaust socket usage.

## citations
- WebRTC IP leak: https://github.com/diafygi/webrtc-ips
- Orignal RunLua Disclosure: https://media.blackhat.com/us-13/US-13-Crowley-Home-Invasion-2-0-WP.pdf
- CVE-2016-6255: http://seclists.org/oss-sec/2016/q3/102

## License
BSD 3-Clause. See the License file.